<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Rich Barton-Cooper</title>
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/css/bootstrap.min.css">
    <link rel="stylesheet" href="static/style.css">
    <link rel="icon" href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><text y=%22.9em%22 font-size=%2290%22>ðŸ‘‹</text></svg>">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Merriweather:ital,wght@0,300;0,700;1,300;1,700&display=swap" rel="stylesheet">
  </head>

  <body>
    <div class="background-container">
      <div class="background-image"></div>

      <main class="content-container">
        <div class="grid-container">
          <!-- Header Card -->
          <div class="header-card" id="header-section">
            <!-- Content will be dynamically inserted here -->
          </div>

          <!-- Tile Grid -->
          <div id="tiles-container">
            <!-- Tiles will be dynamically inserted here -->
          </div>
        </div>
      </main>

      <footer class="copyright">
        Â© <span id="current-year"></span> by Rich Barton-Cooper
      </footer>
    </div>

    <script>
      // Load and render the content
      async function loadContent() {
        try {
          console.log('Fetching content...');
          // Add cache-busting parameter
          const response = await fetch('data/tiles.json?' + new Date().getTime());
          const data = await response.json();
          console.log('Loaded data:', data);

          // Render header
          const header = data.header;
          document.getElementById('header-section').innerHTML = `
            <div class="header-content">
              <h2><i>${header.title}</i> ${header.emoji}</h2>
              <p>${header.description}</p>
              <small><i>${header.subDescription}</i></small>
            </div>
            <div>
              <img src="${header.image}" alt="${header.imageAlt}" class="header-image">
            </div>
          `;
          document.getElementById('header-section').style.backgroundImage = header.gradient;

          // Render tiles
          const tilesContainer = document.getElementById('tiles-container');
          console.log('Number of tiles:', data.tiles.length);

          // Clear existing tiles
          tilesContainer.innerHTML = '';

          data.tiles.forEach((tile, index) => {
            console.log(`Rendering tile ${index + 1}:`, tile.title);
            const tileElement = document.createElement('a');
            tileElement.href = tile.link;
            tileElement.target = "_blank";
            tileElement.className = "tile-card";
            tileElement.style.backgroundImage = tile.gradient;

            // Apply column span if specified
            if (tile.columnSpan && tile.columnSpan > 1) {
              tileElement.style.gridColumn = `span ${tile.columnSpan}`;
              tileElement.style.gridRow = `span 1`; // Explicitly set row span to 1
            }

            tileElement.innerHTML = `
              <img src="${tile.image}" alt="${tile.imageAlt}" class="tile-image">
              <p class="tile-description">${tile.description}</p>
            `;

            tilesContainer.appendChild(tileElement);
          });

          // Update copyright year
          document.getElementById('current-year').textContent = new Date().getFullYear();
        } catch (error) {
          console.error('Error loading content:', error);
          console.error('Error details:', error.message);
        }
      }

      // Load content when the page loads
      document.addEventListener('DOMContentLoaded', loadContent);
    </script>
  </body>
</html>
